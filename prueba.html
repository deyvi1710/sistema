<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Digitalizar Boletas</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 20px auto; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #667eea; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; }
        button:hover { background: #5568d3; }
        .item { background: #f8f9fa; padding: 10px; margin: 10px 0; border-left: 3px solid #667eea; }
        .mensaje { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .exito { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üìù Digitalizar Nueva Boleta</h2>
        
        <div id="mensaje" style="display:none"></div>

        <label>Tipo de Documento:</label>
        <select id="tipo_doc">
            <option value="BOLETA">Boleta</option>
            <option value="FACTURA">Factura</option>
            <option value="GUIA">Gu√≠a de Remisi√≥n</option>
        </select>

        <label>N√∫mero de Documento:</label>
        <input type="text" id="nro_doc" placeholder="Ej: 001-022901">

        <label>Fecha (en la boleta):</label>
        <input type="date" id="fecha">

        <label>Proveedor (RUC):</label>
        <select id="proveedor">
            <option value="">Cargando...</option>
        </select>

        <label>Total (seg√∫n boleta):</label>
        <input type="number" step="0.01" id="total">

        <label>Observaciones:</label>
        <textarea id="obs" rows="2" placeholder="Ej: Boleta manuscrita, dif√≠cil de leer"></textarea>

        <h3>Items de la compra:</h3>
        <div id="items"></div>
        <button type="button" onclick="agregarItem()">‚ûï Agregar Item</button>

        <br><br>
        <button onclick="guardar()">üíæ Guardar Boleta Completa</button>
    </div>

    <script>
        const SUPABASE_URL = 'https://chlkduhcjuioflgcjpko.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_z9a8gB1NL02x7Ubfq-JrTw_N7ZHgutS';

        let itemCount = 0;
        let proveedores = [];
        let productos = [];

        async function api(endpoint, method = 'GET', data = null) {
            const opts = {
                method,
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=representation'
                }
            };
            if (data) opts.body = JSON.stringify(data);
            const res = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}`, opts);
            return res.json();
        }

        async function cargarProveedores() {
            proveedores = await api('oltp_proveedores?estado=eq.ACTIVO&order=nombre_comercial');
            const select = document.getElementById('proveedor');
            select.innerHTML = '<option value="">Seleccione...</option>';
            proveedores.forEach(p => {
                select.innerHTML += `<option value="${p.id_proveedor}">${p.nombre_comercial} (${p.ruc})</option>`;
            });
        }

        async function cargarProductos() {
            productos = await api('oltp_productos?estado=eq.ACTIVO&order=nombre_producto');
        }

        function agregarItem() {
            itemCount++;
            const div = document.createElement('div');
            div.className = 'item';
            div.id = 'item' + itemCount;
            div.innerHTML = `
                <label>Producto:</label>
                <select id="prod${itemCount}">
                    <option value="">Seleccione...</option>
                    ${productos.map(p => `<option value="${p.id_producto}">${p.sku_producto} - ${p.nombre_producto}</option>`).join('')}
                </select>
                <label>Cantidad:</label>
                <input type="number" step="0.01" id="cant${itemCount}">
                <label>Precio Unitario:</label>
                <input type="number" step="0.01" id="precio${itemCount}">
                <button onclick="document.getElementById('item${itemCount}').remove()">üóëÔ∏è Eliminar</button>
            `;
            document.getElementById('items').appendChild(div);
        }

        async function guardar() {
            try {
                // Guardar compra
                const [compra] = await api('oltp_compras', 'POST', {
                    numero_documento: document.getElementById('nro_doc').value,
                    tipo_documento: document.getElementById('tipo_doc').value,
                    fecha_compra: document.getElementById('fecha').value,
                    id_proveedor: parseInt(document.getElementById('proveedor').value),
                    total: parseFloat(document.getElementById('total').value),
                    observaciones: document.getElementById('obs').value
                });

                // Guardar items
                for (let i = 1; i <= itemCount; i++) {
                    const prod = document.getElementById('prod' + i);
                    if (prod && prod.value) {
                        await api('oltp_compras_detalle', 'POST', {
                            id_compra: compra.id_compra,
                            numero_linea: i,
                            id_producto: parseInt(prod.value),
                            cantidad: parseFloat(document.getElementById('cant' + i).value),
                            precio_unitario: parseFloat(document.getElementById('precio' + i).value),
                            total_linea: parseFloat(document.getElementById('cant' + i).value) * parseFloat(document.getElementById('precio' + i).value)
                        });
                    }
                }

                mostrar('‚úÖ Boleta guardada correctamente!', 'exito');
                setTimeout(() => location.reload(), 2000);

            } catch (e) {
                mostrar('‚ùå Error: ' + e.message, 'error');
            }
        }

        function mostrar(msg, tipo) {
            const div = document.getElementById('mensaje');
            div.textContent = msg;
            div.className = 'mensaje ' + tipo;
            div.style.display = 'block';
        }

        window.onload = async () => {
            await cargarProveedores();
            await cargarProductos();
            document.getElementById('fecha').valueAsDate = new Date();
            agregarItem();
        };
    </script>
</body>
</html>
```

**Reemplaza:**
- `TU_PROYECTO` con tu URL de Supabase
- `TU_API_KEY` con tu API key (Settings ‚Üí API ‚Üí anon public)

---

## **PASO 5: FLUJO DE TRABAJO DIARIO**
```
1. Toma una boleta f√≠sica
2. Abre digitalizar.html
3. Llena el formulario
4. Guarda
5. Siguiente boleta